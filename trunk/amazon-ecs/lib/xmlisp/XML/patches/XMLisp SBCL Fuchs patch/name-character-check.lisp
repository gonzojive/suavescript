;;;-*- Mode: Lisp; Package:  xml -*-
;*********************************************************************
;*                                                                   *
;*    PROGRAM     N A M E   C H A R A C T E R   C H E C K            *
;*                                                                   *
;*********************************************************************
;* Author    : Andri Ioannidou (andri@agentsheets.com)               *
;*             http://www.agentsheets.com                            *
;* Copyright : (c) 1996-2001, Agentsheets Inc.                       *
;* Filename  : name-character-check.lisp                             *
;* Updated   : 04/25/00                                              *
;* Version   :                                                       *
;*    1.0    : 04/24/00                                              *
;*    1.1    : 04/18/01 Some optimization                            *
;*    1.2    : 05/21/01 Finished Base-Char-P and Combining-Char-P    * 
;* HW/SW     : PowerPC G4, MCL 4.2 & 3.3                             *
;* Abstract  : Checking for valid XML name characters                *
;*********************************************************************

(in-package :xml)

(defun WHITE-SPACE-P (Char)
  (declare (optimize (speed 3) (safety 0)))
  (case (char-code Char)
    (#x20 t)
    (#x9 t)
    (#xD t)
    (#xA t)
    (t nil)))


(defun NAMECHARP (Char)
  (declare (optimize (speed 3) (safety 0)))
  (or (letterp Char)
      (digitp Char)
      (char= Char #\.)
      (char= Char #\-)
      (char= Char #\_)
      (char= Char #\:)
      (combining-char-p Char)
      (extenderp Char)))


(defun LETTERP (Char)
  (declare (optimize (speed 3) (safety 0)))
  (or (base-char-p Char)
      (ideographicp Char)))


(defun DIGITP (Char)
  (declare (optimize (speed 3) (safety 0)))
  (let ((Code (char-code Char)))
    (or (and (>= Code #x0030) (<= Code #x0039))
        (and (>= Code #x0660) (<= Code #x0669))
        (and (>= Code #x06F0) (<= Code #x06F9))
        (and (>= Code #x0966) (<= Code #x096F))
        (and (>= Code #x09E6) (<= Code #x09EF))
        (and (>= Code #x0A66) (<= Code #x0A6F))
        (and (>= Code #x0AE6) (<= Code #x0AEF))
        (and (>= Code #x0B66) (<= Code #x0B6F))
        (and (>= Code #x0BE7) (<= Code #x0BEF))
        (and (>= Code #x0C66) (<= Code #x0C6F))
        (and (>= Code #x0CE6) (<= Code #x0CEF))
        (and (>= Code #x0D66) (<= Code #x0D6F))
        (and (>= Code #x0E50) (<= Code #x0E59))
        (and (>= Code #x0ED0) (<= Code #x0ED9))
        (and (>= Code #x0F20) (<= Code #x0F29)))))


(defun COMBINING-CHAR-P (Char)
  (declare (optimize (speed 3) (safety 0)))
  (let ((Code (char-code Char)))
    (or (and (>= Code #x0300) (<= Code #x0345))
        (and (>= Code #x0360) (<= Code #x0361))
        (and (>= Code #x0483) (<= Code #x0486))
        (and (>= Code #x0591) (<= Code #x05A1))
        (and (>= Code #x05A3) (<= Code #x05B9))
        (and (>= Code #x05BB) (<= Code #x05BD))
        (= Code #x05BF)
        (and (>= Code #x05C1) (<= Code #x05C2))
        (= Code #x05C4)
        (and (>= Code #x064B) (<= Code #x0652))
        (= Code #x0670)
        (and (>= Code #x06D6) (<= Code #x06DC))
        (and (>= Code #x06DD) (<= Code #x06DF))
        (and (>= Code #x06E0) (<= Code #x06E4))
        (and (>= Code #x06E7) (<= Code #x06E8))
        (and (>= Code #x06EA) (<= Code #x06ED))
        (and (>= Code #x0901) (<= Code #x0903))
        (= Code #x093C)
        (and (>= Code #x093E) (<= Code #x094C))
        (= Code #x094D)
        (and (>= Code #x0951) (<= Code #x0954))
        (and (>= Code #x0962) (<= Code #x0963))
        (and (>= Code #x0981) (<= Code #x0983))
        (= Code #x09BC)
        (= Code #x09BE)
        (= Code #x09BF)
        (and (>= Code #x09C0) (<= Code #x09C4))
        (and (>= Code #x09C7) (<= Code #x09C8))
        (and (>= Code #x09CB) (<= Code #x09CD))
        (= Code #x09D7)
        (and (>= Code #x09E2) (<= Code #x09E3))
        (= Code #x0A02)
        (= Code #x0A3C)
        (= Code #x0A3E)
        (= Code #x0A3F)
        (and (>= Code #x0A40) (<= Code #x0A42))
        (and (>= Code #x0A47) (<= Code #x0A48))
        (and (>= Code #x0A4B) (<= Code #x0A4D))
        (and (>= Code #x0A70) (<= Code #x0A71))
        (and (>= Code #x0A81) (<= Code #x0A83))
        (= Code #x0ABC)
        (and (>= Code #x0ABE) (<= Code #x0AC5))
        (and (>= Code #x0AC7) (<= Code #x0AC9))
        (and (>= Code #x0ACB) (<= Code #x0ACD))
        (and (>= Code #x0B01) (<= Code #x0B03))
        (= Code #x0B3C)
        (and (>= Code #x0B3E) (<= Code #x0B43))
        (and (>= Code #x0B47) (<= Code #x0B48))
        (and (>= Code #x0B4B) (<= Code #x0B4D))
        (and (>= Code #x0B56) (<= Code #x0B57))
        (and (>= Code #x0B82) (<= Code #x0B83))
        (and (>= Code #x0BBE) (<= Code #x0BC2))
        (and (>= Code #x0BC6) (<= Code #x0BC8))
        (and (>= Code #x0BCA) (<= Code #x0BCD))
        (= Code #x0BD7)
        (and (>= Code #x0C01) (<= Code #x0C03))
        (and (>= Code #x0C3E) (<= Code #x0C44))
        (and (>= Code #x0C46) (<= Code #x0C48))
        (and (>= Code #x0C4A) (<= Code #x0C4D))
        (and (>= Code #x0C55) (<= Code #x0C56))
        (and (>= Code #x0C82) (<= Code #x0C83))
        (and (>= Code #x0CBE) (<= Code #x0CC4))
        (and (>= Code #x0CC6) (<= Code #x0CC8))
        (and (>= Code #x0CCA) (<= Code #x0CCD))
        (and (>= Code #x0CD5) (<= Code #x0CD6))
        (and (>= Code #x0D02) (<= Code #x0D03))
        (and (>= Code #x0D3E) (<= Code #x0D43))
        (and (>= Code #x0D46) (<= Code #x0D48))
        (and (>= Code #x0D4A) (<= Code #x0D4D))
        (= Code #x0D57)
        (= Code #x0E31)
        (and (>= Code #x0E34) (<= Code #x0E3A))
        (and (>= Code #x0E47) (<= Code #x0E4E))
        (= Code #x0EB1)
        (and (>= Code #x0EB4) (<= Code #x0EB9))
        (and (>= Code #x0EBB) (<= Code #x0EBC))
        (and (>= Code #x0EC8) (<= Code #x0ECD))
        (and (>= Code #x0F18) (<= Code #x0F19))
        (= Code #x0F35)
        (= Code #x0F37)
        (= Code #x0F39)
        (= Code #x0F3E)
        (= Code #x0F3F)
        (and (>= Code #x0F71) (<= Code #x0F84))
        (and (>= Code #x0F86) (<= Code #x0F8B))
        (and (>= Code #x0F90) (<= Code #x0F95))
        (= Code #x0F97)
        (and (>= Code #x0F99) (<= Code #x0FAD))
        (and (>= Code #x0FB1) (<= Code #x0FB7))
        (= Code #x0FB9)
        (and (>= Code #x20D0) (<= Code #x20DC))
        (= Code #x20E1)
        (and (>= Code #x302A) (<= Code #x302F))
        (= Code #x3099)
        (= Code #x309A))))


(defun EXTENDERP (Char)
  (declare (optimize (speed 3) (safety 0)))
  (let ((Code (char-code Char)))
    (or (= Code #x00B7)
        (= Code #x02D0)
        (= Code #x02D1)
        (= Code #x0387)
        (= Code #x0640)
        (= Code #x0E46)
        (= Code #x0EC6)
        (= Code #x3005) 
        (and (>= Code #x3031) (<= Code #x3035))
        (and (>= Code #x309D) (<= Code #x309E))
        (and (>= Code #x30FC) (<= Code #x30FE)))))


(defun BASE-CHAR-P (Char)
  (declare (optimize (speed 3) (safety 0)))
  (let ((Code (char-code Char)))
    (or (and (>= Code #x0041) (<= Code #x005A))
        (and (>= Code #x0061) (<= Code #x007A))
        (and (>= Code #x00C0) (<= Code #x00D6))
        (and (>= Code #x00D8) (<= Code #x00F6))
        (and (>= Code #x00F8) (<= Code #x00FF))
        (and (>= Code #x0100) (<= Code #x0131))
        (and (>= Code #x0134) (<= Code #x013E))
        (and (>= Code #x0141) (<= Code #x0148))
        (and (>= Code #x014A) (<= Code #x017E))
        (and (>= Code #x0180) (<= Code #x01C3))
        (and (>= Code #x01CD) (<= Code #x01F0))
        (and (>= Code #x01F4) (<= Code #x01F5))
        (and (>= Code #x01FA) (<= Code #x0217))
        (and (>= Code #x0250) (<= Code #x02A8))
        (and (>= Code #x02BB) (<= Code #x02C1))
        (= Code #x0386)
        (and (>= Code #x0388) (<= Code #x038A))
        (= Code #x038C)
        (and (>= Code #x038E) (<= Code #x03A1))
        (and (>= Code #x03A3) (<= Code #x03CE))
        (and (>= Code #x03D0) (<= Code #x03D6))
        (= Code #x03DA)
        (= Code #x03DC)
        (= Code #x03DE)
        (= Code #x03E0)
        (and (>= Code #x03E2) (<= Code #x03F3))
        (and (>= Code #x0401) (<= Code #x040C))
        (and (>= Code #x040E) (<= Code #x044F))
        (and (>= Code #x0451) (<= Code #x045C))
        (and (>= Code #x045E) (<= Code #x0481))
        (and (>= Code #x0490) (<= Code #x04C4))
        (and (>= Code #x04C7) (<= Code #x04C8))
        (and (>= Code #x04CB) (<= Code #x04CC))
        (and (>= Code #x04D0) (<= Code #x04EB))
        (and (>= Code #x04EE) (<= Code #x04F5))
        (and (>= Code #x04F8) (<= Code #x04F9))
        (and (>= Code #x0531) (<= Code #x0556))
        (= Code #x0559)
        (and (>= Code #x0561) (<= Code #x0586))
        (and (>= Code #x05D0) (<= Code #x05EA))
        (and (>= Code #x05F0) (<= Code #x05F2))
        (and (>= Code #x0621) (<= Code #x063A))
        (and (>= Code #x0641) (<= Code #x064A))
        (and (>= Code #x0671) (<= Code #x06B7))
        (and (>= Code #x06BA) (<= Code #x06BE))
        (and (>= Code #x06C0) (<= Code #x06CE))
        (and (>= Code #x06D0) (<= Code #x06D3))
        (= Code #x06D5)
        (and (>= Code #x06E5) (<= Code #x06E6))
        (and (>= Code #x0905) (<= Code #x0939))
        (= Code #x093D)
        (and (>= Code #x0958) (<= Code #x0961))
        (and (>= Code #x0985) (<= Code #x098C))
        (and (>= Code #x098F) (<= Code #x0990))
        (and (>= Code #x0993) (<= Code #x09A8))
        (and (>= Code #x09AA) (<= Code #x09B0))
        (= Code #x09B2)
        (and (>= Code #x09B6) (<= Code #x09B9))
        (and (>= Code #x09DC) (<= Code #x09DD))
        (and (>= Code #x09DF) (<= Code #x09E1))
        (and (>= Code #x09F0) (<= Code #x09F1))
        (and (>= Code #x0A05) (<= Code #x0A0A))
        (and (>= Code #x0A0F) (<= Code #x0A10))
        (and (>= Code #x0A13) (<= Code #x0A28))
        (and (>= Code #x0A2A) (<= Code #x0A30))
        (and (>= Code #x0A32) (<= Code #x0A33))
        (and (>= Code #x0A35) (<= Code #x0A36))
        (and (>= Code #x0A38) (<= Code #x0A39))
        (and (>= Code #x0A59) (<= Code #x0A5C))
        (= Code #x0A5E)
        (and (>= Code #x0A72) (<= Code #x0A74))
        (and (>= Code #x0A85) (<= Code #x0A8B))
        (= Code #x0A8D)
        (and (>= Code #x0A8F) (<= Code #x0A91))
        (and (>= Code #x0A93) (<= Code #x0AA8))
        (and (>= Code #x0AAA) (<= Code #x0AB0))
        (and (>= Code #x0AB2) (<= Code #x0AB3))
        (and (>= Code #x0AB5) (<= Code #x0AB9))
        (= Code #x0ABD)
        (= Code #x0AE0)
        (and (>= Code #x0B05) (<= Code #x0B0C))
        (and (>= Code #x0B0F) (<= Code #x0B10))
        (and (>= Code #x0B13) (<= Code #x0B28))
        (and (>= Code #x0B2A) (<= Code #x0B30))
        (and (>= Code #x0B32) (<= Code #x0B33))
        (and (>= Code #x0B36) (<= Code #x0B39))
        (= Code #x0B3D)
        (and (>= Code #x0B5C) (<= Code #x0B5D))
        (and (>= Code #x0B5F) (<= Code #x0B61))
        (and (>= Code #x0B85) (<= Code #x0B8A))
        (and (>= Code #x0B8E) (<= Code #x0B90))
        (and (>= Code #x0B92) (<= Code #x0B95))
        (and (>= Code #x0B99) (<= Code #x0B9A))
        (= Code #x0B9C)
        (and (>= Code #x0B9E) (<= Code #x0B9F))
        (and (>= Code #x0BA3) (<= Code #x0BA4))
        (and (>= Code #x0BA8) (<= Code #x0BAA))
        (and (>= Code #x0BAE) (<= Code #x0BB5))
        (and (>= Code #x0BB7) (<= Code #x0BB9))
        (and (>= Code #x0C05) (<= Code #x0C0C))
        (and (>= Code #x0C0E) (<= Code #x0C10))
        (and (>= Code #x0C12) (<= Code #x0C28))
        (and (>= Code #x0C2A) (<= Code #x0C33))
        (and (>= Code #x0C35) (<= Code #x0C39))
        (and (>= Code #x0C60) (<= Code #x0C61))
        (and (>= Code #x0C85) (<= Code #x0C8C))
        (and (>= Code #x0C8E) (<= Code #x0C90))
        (and (>= Code #x0C92) (<= Code #x0CA8))
        (and (>= Code #x0CAA) (<= Code #x0CB3))
        (and (>= Code #x0CB5) (<= Code #x0CB9))
        (= Code #x0CDE)
        (and (>= Code #x0CE0) (<= Code #x0CE1))
        (and (>= Code #x0D05) (<= Code #x0D0C))
        (and (>= Code #x0D0E) (<= Code #x0D10))
        (and (>= Code #x0D12) (<= Code #x0D28))
        (and (>= Code #x0D2A) (<= Code #x0D39))
        (and (>= Code #x0D60) (<= Code #x0D61))
        (and (>= Code #x0E01) (<= Code #x0E2E))
        (= Code #x0E30)
        (and (>= Code #x0E32) (<= Code #x0E33))
        (and (>= Code #x0E40) (<= Code #x0E45))
        (and (>= Code #x0E81) (<= Code #x0E82))
        (= Code #x0E84)
        (and (>= Code #x0E87) (<= Code #x0E88))
        (= Code #x0E8A)
        (= Code #x0E8D)
        (and (>= Code #x0E94) (<= Code #x0E97))
        (and (>= Code #x0E99) (<= Code #x0E9F))
        (and (>= Code #x0EA1) (<= Code #x0EA3))
        (= Code #x0EA5)
        (= Code #x0EA7)
        (and (>= Code #x0EAA) (<= Code #x0EAB))
        (and (>= Code #x0EAD) (<= Code #x0EAE))
        (= Code #x0EB0)
        (and (>= Code #x0EB2) (<= Code #x0EB3))
        (= Code #x0EBD)
        (and (>= Code #x0EC0) (<= Code #x0EC4))
        (and (>= Code #x0F40) (<= Code #x0F47))
        (and (>= Code #x0F49) (<= Code #x0F69))
        (and (>= Code #x10A0) (<= Code #x10C5))
        (and (>= Code #x10D0) (<= Code #x10F6))
        (= Code #x1100)
        (and (>= Code #x1102) (<= Code #x1103))
        (and (>= Code #x1105) (<= Code #x1107))
        (= Code #x1109)
        (and (>= Code #x110B) (<= Code #x110C))
        (and (>= Code #x110E) (<= Code #x1112))
        (= Code #x113C)
        (= Code #x113E)
        (= Code #x1140)
        (= Code #x114C)
        (= Code #x114E)
        (= Code #x1150)
        (and (>= Code #x1154) (<= Code #x1155))
        (= Code #x1159)
        (and (>= Code #x115F) (<= Code #x1161))
        (= Code #x1163)
        (= Code #x1165)
        (= Code #x1167)
        (= Code #x1169)
        (and (>= Code #x116D) (<= Code #x116E))
        (and (>= Code #x1172) (<= Code #x1173))
        (= Code #x1175)
        (= Code #x119E)
        (= Code #x11A8)
        (= Code #x11AB)
        (and (>= Code #x11AE) (<= Code #x11AF))
        (and (>= Code #x11B7) (<= Code #x11B8))
        (= Code #x11BA)
        (and (>= Code #x11BC) (<= Code #x11C2))
        (= Code #x11EB)
        (= Code #x11F0)
        (= Code #x11F9)
        (and (>= Code #x1E00) (<= Code #x1E9B))
        (and (>= Code #x1EA0) (<= Code #x1EF9))
        (and (>= Code #x1F00) (<= Code #x1F15))
        (and (>= Code #x1F18) (<= Code #x1F1D))
        (and (>= Code #x1F20) (<= Code #x1F45))
        (and (>= Code #x1F48) (<= Code #x1F4D))
        (and (>= Code #x1F50) (<= Code #x1F57))
        (= Code #x1F59)
        (= Code #x1F5B)
        (= Code #x1F5D)
        (and (>= Code #x1F5F) (<= Code #x1F7D))
        (and (>= Code #x1F80) (<= Code #x1FB4))
        (and (>= Code #x1FB6) (<= Code #x1FBC))
        (= Code #x1FBE)
        (and (>= Code #x1FC2) (<= Code #x1FC4))
        (and (>= Code #x1FC6) (<= Code #x1FCC))
        (and (>= Code #x1FD0) (<= Code #x1FD3))
        (and (>= Code #x1FD6) (<= Code #x1FDB))
        (and (>= Code #x1FE0) (<= Code #x1FEC))
        (and (>= Code #x1FF2) (<= Code #x1FF4))
        (and (>= Code #x1FF6) (<= Code #x1FFC))
        (= Code #x2126)
        (and (>= Code #x212A) (<= Code #x212B))
        (= Code #x212E)
        (and (>= Code #x2180) (<= Code #x2182))
        (and (>= Code #x3041) (<= Code #x3094))
        (and (>= Code #x30A1) (<= Code #x30FA))
        (and (>= Code #x3105) (<= Code #x312C))
        (and (>= Code #xAC00) (<= Code #xD7A3)))))


(defun IDEOGRAPHICP (Char)
  (declare (optimize (speed 3) (safety 0)))
  (let ((Code (char-code Char)))
    (or (= Code #x3007)
        (and (>= Code #x4E00) (<= Code #x9FA5))
        (and (>= Code #x3021) (<= Code #x3029)))))